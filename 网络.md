### 概念：

1. 协议：
   * http: (hyper text transfer protocol， 超文本传输协议) 是一个简单的请求-响应协议，它通常运行在[TCP](https://baike.baidu.com/item/TCP/33012)之上。它指定了客户端可能发送给服务器什么样的消息以及得到什么样的响应。
   * https:(hyper text transfer protocol over secure socket layer), 基于 http 协议新增了一层 ssl 层，主要作用对传输的数据进行加密。增加中间人破解的成本。
   * SSL（Secure Socket Layer，安全套接字层）：1994年为 Netscape 所研发，SSL 协议位于 TCP/IP 协议与各种应用层协议之间，为数据通讯提供安全支持
2. 加密算法：
   * 对称加密： 采用单钥密码系统的加密方法，同一个密钥可以同时用作信息的加密和解密，这种加密方法称为对称加密，也称为单密钥加密。
   * 非对称加密：需要两个秘钥进行加密解密，这两个秘钥分为**公开秘钥(Public key)**和**私有秘钥(private key)**。
   * 哈希算法：简单的说就是一种将任意长度的消息压缩到某一固定长度的消息摘要的函数。
   * 数字签名：是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。类比现实中的手写签名可以证明自己。



### 详细过程

1.  请求过程：

   * http

     ![image-20210808110737768](https://tzy-1259080244.cos.ap-shanghai.myqcloud.com/image-20210808110737768.png)

     受到中间人拦击

     ![image-20210808111027011](https://tzy-1259080244.cos.ap-shanghai.myqcloud.com/image-20210808111027011.png)

     我们最熟悉的就是 charles，charles拦截了页面所有请求与相应，并且能够修改所拦截到的信息。还有就是以前一些网络服务运营商经常会对页面进行拦截，一大堆的广告弹窗。

   * https

     **非对称加密**:

     > 公钥和私钥: 公钥加密后的内容只有私钥能解，私钥加密的内容只有公钥能解。私钥一般是发送者独有的，公钥匙对外部公开的

     A：通过 SHA 计算原文的**摘要**(唯一, 不同的原文生成的摘要不同)，再用自己的私钥加密摘要，得到**签名**，然后 A 把**公钥、签名和原文**发送给B

     B：接收到**公钥、签名和原文**，用公钥解开签名得到**摘要**，然后用 SHA 计算原文**摘要**，进行对比。

     * 但是如何保证公钥没问题？

     这时候引入第三方机构(CA, certificate authority):

     A: 先计算摘要，然后用自己的私钥对摘要(除了摘要可能还包含其他信息)进行加密，再通过第三方机构的私钥进行加密得到**证书**(和签名类似)，然后将证书发送给B。

     B：接收到证书，先验证机构，拿到机构的公钥。用公钥去解密证书，拿到原文摘要和原文。再对原文进行计算得到摘要，进行对比。

     * 如果第三方机构有问题？

       可以引入多级机构。因为没有办法杜绝，所以采用增加破解成本方法。此时如果出现问题，那就需要所有机构同时合伙才会出现问题。

     **对称加密**:

     双方使用同一个密钥，通过这一个密钥进行加解密。前提是双方协商好密钥。非对称加密则不需要。

   * ![image-20210808140139812](https://tzy-1259080244.cos.ap-shanghai.myqcloud.com/image-20210808140139812.png)

     ![](https://pic4.zhimg.com/80/v2-1ea0209a526f3527a713736fe7609fcf_720w.jpg)

     1. 首先由客户端发起建立请求，该请求中携带客户端生成的一个随机数，支持的协议版本，支持的加密方式；

     2. 服务端接收到响应，回复客户端：确认使用的协议版本、确认的加密方式、一个服务端生成的随机数，服务器证书。

     3. 客户端接收到响应，判断证书是否可信，进行解密取出公钥，然后再向服务端发送用公钥加密后的内容：一个新的随机数

     4. 服务端接响应，用自己的私钥解密出客户端的随机数，根据收到的三个随机数生成会话秘钥，根据该秘钥对内容进行加密，发送给客户端进行解密验证。

        至此双方确认了加密方式，同时各自都有一个会话秘钥，可以对后续的内容进行加/解密。

     

     问题：

     1. 为什么不直接使用非对称加密，还需要确认一对会话秘钥？

        * 非对称加密的加解密效率是非常低的，而 http 的应用场景中通常端与端之间存在大量的交互，非对称加密的效率是无法接受的。

     2. 为什么不直接用对称加密？

        * 安全性考虑，对称加密中解密和加密使用的是一样的秘钥，一旦泄露加密将毫无作用。

     3. 为什么需要用三个随机数生成会话秘钥？

        * 计算机中的随机数其实并不随机，三个随机数将随机变得更随机，更难被猜出。

     4. 怎么判断证书是合法的？

        * 浏览器中内置了一些权威证书，浏览器会根据这个列表进行判断。自己也可以对这个列表进行增删操作。如果验证未通过会提示警告

        

     

     

     

     